{"name":"Processus","tagline":"","body":"```\r\n ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n(  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n(__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n```\r\n\r\n# Processus\r\n\r\nProcessus is a simple lightweight workflow engine designed to help orchestrate multiple tasks. \r\n\r\nThere are many workflow engines already, but Processus makes some very specific assumptions that make it easy to quickly write simple, yet powerful\r\nworkflows.\r\n\r\n\r\n\r\n[Getting Started](#getting-started)\r\n  * [Installation](#installation)\r\n  * [Intoduction](#introduction)\r\n\r\n[Processus Engine In Detail](#processus-engine-in-detail)\r\n  * [Tasks - Sequential Tasks](#tasks---sequential-tasks)\r\n  * [Tasks - Parallel Tasks](#tasks---parallel-tasks)\r\n  * [Tasks - Nested Tasks (Sequential)](#tasks---nested-tasks-sequential)\r\n  * [Tasks - Nested Tasks (Parallel)](#tasks---nested-tasks-parallel)\r\n  * [Tasks - Mixing Sequential and Parallel tasks](#tasks---mixing-sequential-and-parallel-tasks)\r\n  * [Tasks - Passing Data from Task to Task](#tasks---passing-data-from-task-to-task)\r\n  * [Workflow - Passing Static Data to Tasks](#workflow---passing-static-data-to-tasks)\r\n  * [Workflow - Handling Errors](#workflow---handling-errors)\r\n  * [Task Handlers - The Interface](#task-handlers---the-interface)\r\n  * [Task Handlers - Shell Handler](#task-handlers---shell-handler)\r\n  * [Task Handlers - Shell Demo](#task-handlers---shell-demo)\r\n  * [Tasks - Conditions skipIf and errorIf](#tasks---conditions-skipIf-and-errorIf)\r\n\r\n[Contributing](#contributing)\r\n  * [Contributing - Roadmap](#contributing---roadmap)\r\n\r\n<hr>\r\n\r\n#Getting Started\r\n\r\n## Installation\r\n\r\nInstall using npm within your project\r\n```\r\nnpm install --save processus\r\n```\r\n\r\nInstall globally for use on the command line\r\n```\r\nnpm install -g processus\r\n```\r\n\r\nor clone this repo\r\n```\r\ngit clone https://github.com/cloudb2/processus\r\n```\r\n\r\nA workflow in Processus is defined using JSON, which should conform to a specific\r\nstructure. The best way to understand that structure is by looking at examples.\r\n\r\nA workflow, in it's simplest form, is defined as follows.\r\n\r\n```\r\n{\r\n  \"tasks\": {\r\n  },\r\n  \"id\": \"[instance UUID]\"\r\n  \"status\": \"[open|error|completed]\"\r\n}\r\n```\r\nBoth id and status are added by processus at execution time.\r\n\r\nexecute the above example ex1.json using the following command.\r\n```\r\n../bin/processus-cli -l info -f ./test/ex1.json\r\n```\r\n\r\nYou should see something like this.\r\n```\r\n$ ./bin/processus-cli -l info -f test/ex1.json\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-11-12 00:59:16 INFO ✰ Workflow [test/ex1.json] exited without error, but did not complete.\r\n```\r\n***Note***\r\n1. You can add additional meta data to the workflow such as a name and description, but that will be ignored by Processus.\r\n2. The status of a workflow can be open, error or completed.\r\n3. In this example there are no tasks, so the Processus returns open, assuming that a task will be injected later. More on this later.\r\n\r\nexecute ex1 again, this time with a log level of debug.\r\n```\r\n../bin/processus-cli -l info -f ./test/ex1.json\r\n```\r\n\r\nYou should see something like this.\r\n```\r\n$ ./bin/processus-cli -l debug -f test/ex1.json\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-11-12 01:02:00 DEBUG save point a reached.\r\n2015-11-12 01:02:00 DEBUG save point c reached.\r\n2015-11-12 01:02:00 DEBUG Workflow returned successfully.\r\n2015-11-12 01:02:00 DEBUG {\r\n  \"tasks\": {},\r\n  \"status\": \"open\",\r\n  \"id\": \"33fda8ab-4cac-4acb-80fa-65c731eb6983\"\r\n}\r\n2015-11-12 01:02:00 INFO ✰ Workflow [test/ex1.json] exited without error, but did not complete.\r\n```\r\n***Note***\r\n1. The status and id have been added by Processus\r\n\r\n\r\n## Introduction\r\n\r\n\r\nProcessus assumes that the person assembling the workflow is NOT necessarily familiar with the nuances of software development. Although they use JSON to configure the workflow, its executional flow and conditional constructs, they will defer the difficult task of interacting with various endpoints and systems to the task handlers. In short, Processus tries to employ a KIS (Keep It Simple) philosophy to its configuration.\r\n\r\nLet's suppose we want 3 tasks in series.\r\nLook at the JSON file ```./test/demo1.json```\r\n\r\n```\r\n{\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take 1000msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1000,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take 500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 500,\r\n        \"error\": false\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThis JSON file will execute the tasks sequentially. i.e.\r\n```task 1``` -> ```task 2``` -> ```task 3```\r\n\r\nBefore we run this file in Processus, let's take a quick look at the Task object.\r\n```\r\n\"task 1\": {\r\n  \"description\": \"I am the task 1, I take 1500msecs.\",\r\n  \"blocking\": true,\r\n  \"handler\" : \"../taskHandlers/testHandler\",\r\n  \"data\": {\r\n    \"delay\": 1500,\r\n    \"error\": false\r\n  }\r\n}\r\n```\r\nNote the following:\r\n\r\n1. **The Task Name**: The task name can contain spaces, but obviously each name must be unique or it's\r\nnot valid JSON. In this case the name of the first task is ```task 1```\r\n2. **description**: A simple string containing a description of the task\r\n3. **blocking**: A boolean value telling Processus if you wish to block during the execution of this task\r\nor not. If you block for each task, they will all run sequentially. If you set this to false they\r\nwill run in parallel (more on this later).\r\n4. **handler**: Is a string specifying the module name to handle the task. Processus comes with an\r\nexample task handler called ```testHandler```, which simply outputs the task details.\r\n5. **data**: The data object contains information used by the task handler. In this case\r\nthe handler ```testHandler``` uses the data parameters ```delay``` (how long the task is delayed) and\r\n```error``` whether the task should raise an error when it finishes. More on data objects later.\r\n6. Procesus will run the tasks in the order they're defined within the parent workflow object, unless blocking is set to false.\r\n\r\nOk, now we have the simplest definition of a task, let's run the file demo1.json\r\n\r\nfirst run the following to see the cli options. It's assumed you're executing Processus in the directory in which it was installed.\r\n```\r\n$ ./bin/processus-cli -h\r\n```\r\n\r\nYou should see something similar to the following.\r\n```\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\nUsage:\r\n  processus-cli [OPTIONS] [ARGS]\r\n\r\nOptions:\r\n  -l, --loglevel [STRING]Set loglevel [debug|verbose|info|warn|error] (Default is error)\r\n  -f, --file [FILE]      Workflow filename (Default is workflow.json)\r\n  -h, --help             Display help and usage details\r\n\r\n```\r\n\r\n**Notice** that Processus defaults to the error log level, so you won't see any output other than errors. For the purposes of the demo, let's change the loglevel to ```info``` and specify the filename ```./test/demo1.json```\r\n\r\n```\r\n$ ./bin/processus-cli -l info -f ./test/demo1.json\r\n```\r\n\r\nThe output should look something like this.\r\n```\r\n...\r\n\r\n2015-10-12 23:24:16 INFO testHandler:\r\n executing task 1\r\n2015-10-12 23:24:16 INFO Task Description:\r\n I am the task 1, I take 1500msecs.\r\n2015-10-12 23:24:18 INFO testHandler:\r\n completed task 1\r\n2015-10-12 23:24:18 INFO testHandler:\r\n executing task 2\r\n2015-10-12 23:24:18 INFO Task Description:\r\n I am the task 2, I take 1000msecs.\r\n2015-10-12 23:24:19 INFO testHandler:\r\n completed task 2\r\n2015-10-12 23:24:19 INFO testHandler:\r\n executing task 3\r\n2015-10-12 23:24:19 INFO Task Description:\r\n I am the task 3, I take 500msecs.\r\n2015-10-12 23:24:19 INFO testHandler:\r\n completed task 3\r\n2015-10-12 23:24:19 INFO Workflow returned successfully.\r\n```\r\n\r\nThat's it, you executed your first workflow using Processus!\r\n\r\nIn this case, it didn't do a lot, except simulate 3 tasks, running sequentially,\r\nand each delayed half a second less than the previous task.\r\n\r\nLet's look a little closer at the workflow and tasks that returned from Processus.\r\n\r\nExecute the same command again, this time setting the loglevel to ```debug```\r\n\r\n```\r\n$ ./bin/processus-cli -l debug -f ./test/demo1.json\r\n```\r\n\r\nThe output should look something like this.\r\n```\r\n...\r\n\r\n2015-10-12 22:57:37 INFO Workflow returned successfully.\r\n2015-10-12 22:57:37 DEBUG {\r\n  \"tasks\": {\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444690654882,\r\n      \"timeStarted\": 1444690654883,\r\n      \"timeCompleted\": 1444690655396,\r\n      \"handlerDuration\": 513,\r\n      \"totalDuration\": 514\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take 1000msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1000,\r\n        \"error\": false\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444690655396,\r\n      \"timeStarted\": 1444690655396,\r\n      \"timeCompleted\": 1444690656403,\r\n      \"handlerDuration\": 1007,\r\n      \"totalDuration\": 1007\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take 500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 500,\r\n        \"error\": false\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444690656404,\r\n      \"timeStarted\": 1444690656404,\r\n      \"timeCompleted\": 1444690657908,\r\n      \"handlerDuration\": 1504,\r\n      \"totalDuration\": 1504\r\n    }\r\n  },\r\n  \"status\": \"completed\"\r\n}\r\n```\r\n\r\n**Notice** that the Processus engine has added additional information to each task and the parent workflow objects.\r\n\r\nThis includes the following:\r\n\r\n1. **status** A status for each task and the overall workflow\r\n2. **timeOpened** The time (milliseconds elapsed since 1 January 1970 00:00:00 UTC up until now) the task was opened.\r\n3. **timeStarted** The time the task was started. Later we'll explore why this can be different to timeOpened\r\n4. **timeCompleted** The time the task completed\r\n5. **handlerDuration** The time it took the handler to execute the task\r\n6. **totalDuration** The total duration the task was opened. Later we'll explore why this can be different to handlerDuration\r\n[top](#processus)\r\n\r\n<hr>\r\n# Processus Engine In Detail\r\n\r\n## Tasks - Sequential Tasks\r\n\r\n```\r\n(start)----[task 1]-----[task 2]-----[task 3]----(end)\r\n```\r\n\r\nThe JSON config file (demo1)\r\n<pre><code>\r\n{\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": <b>true</b>,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take 1000msecs.\",\r\n      \"blocking\": <b>true</b>,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1000,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take 500msecs.\",\r\n      \"blocking\": <b>true</b>,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 500,\r\n        \"error\": false\r\n      }\r\n    }\r\n  }\r\n}\r\n</code></pre>\r\n\r\nRunning the demo\r\n```\r\n$ ./bin/processus-cli -l info -f ./test/demo1.json\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-10-12 23:24:16 INFO testHandler:\r\n executing task 1\r\n2015-10-12 23:24:16 INFO Task Description:\r\n I am the task 1, I take 1500msecs.\r\n2015-10-12 23:24:18 INFO testHandler:\r\n completed task 1\r\n2015-10-12 23:24:18 INFO testHandler:\r\n executing task 2\r\n2015-10-12 23:24:18 INFO Task Description:\r\n I am the task 2, I take 1000msecs.\r\n2015-10-12 23:24:19 INFO testHandler:\r\n completed task 2\r\n2015-10-12 23:24:19 INFO testHandler:\r\n executing task 3\r\n2015-10-12 23:24:19 INFO Task Description:\r\n I am the task 3, I take 500msecs.\r\n2015-10-12 23:24:19 INFO testHandler:\r\n completed task 3\r\n2015-10-12 23:24:19 INFO Workflow returned successfully.\r\n```\r\n\r\n[top](#processus)\r\n\r\n\r\n## Tasks - Parallel Tasks\r\n```\r\n(start)-+--[task 1]--+-(end)\r\n        |--[task 2]--|\r\n        +--[task 3]--+\r\n```\r\n\r\nThe JSON config file (demo2)\r\n<pre><code>\r\n{\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": <b>false</b>,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take 1000msecs.\",\r\n      \"blocking\": <b>false</b>,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1000,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take 500msecs.\",\r\n      \"blocking\": <b>false</b>,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 500,\r\n        \"error\": false\r\n      }\r\n    }\r\n  }\r\n}\r\n</code></pre>\r\n**Notice** blocking is set to ```false``` for each task, causing them all to run in\r\nparallel.\r\n\r\nRunning the demo\r\n<pre><code>\r\n$ ./bin/processus-cli -l info -f ./test/demo2.json\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-10-12 23:26:32 INFO testHandler:\r\n executing task 1\r\n2015-10-12 23:26:32 INFO Task Description:\r\n I am the task 1, I take 1500msecs.\r\n2015-10-12 23:26:32 INFO testHandler:\r\n executing task 2\r\n2015-10-12 23:26:32 INFO Task Description:\r\n I am the task 2, I take 1000msecs.\r\n2015-10-12 23:26:32 INFO testHandler:\r\n executing task 3\r\n2015-10-12 23:26:32 INFO Task Description:\r\n I am the task 3, I take 500msecs.\r\n2015-10-12 23:26:33 INFO testHandler:\r\n <b>completed task 3</b>\r\n2015-10-12 23:26:33 INFO testHandler:\r\n <b>completed task 2</b>\r\n2015-10-12 23:26:34 INFO testHandler:\r\n <b>completed task 1</b>\r\n2015-10-12 23:26:34 INFO Workflow returned successfully.\r\n</code></pre>\r\n**Notice** the tasks completed in reverse order (due to the time delays), but overall\r\nthe workflow completed quicker than the previous demo.\r\n\r\n[top](#processus)\r\n\r\n\r\n## Tasks - Nested Tasks (Sequential)\r\n```\r\n(start)----[task 1]-----[          task 2          ]-----[task 3]----(end)\r\n                        |                          |\r\n                        ()-[task 2-1]--[task 2-2]-()\r\n```\r\nThe JSON config file (demo3)\r\n<pre><code>\r\n{\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take 1000msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1000,\r\n        \"error\": false\r\n      },\r\n      <b>\"tasks\"</b>: {\r\n        \"task 2-1\": {\r\n          \"description\": \"I am the task 2-1, I take 1000msecs.\",\r\n          \"blocking\": true,\r\n          \"handler\" : \"../taskHandlers/testHandler\",\r\n          \"data\": {\r\n            \"delay\": 1000,\r\n            \"error\": false\r\n          }\r\n        },\r\n        \"task 2-2\": {\r\n          \"description\": \"I am the task 2-2, I take 1000msecs.\",\r\n          \"blocking\": true,\r\n          \"handler\" : \"../taskHandlers/testHandler\",\r\n          \"data\": {\r\n            \"delay\": 1000,\r\n            \"error\": false\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take 500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 500,\r\n        \"error\": false\r\n      }\r\n    }\r\n  }\r\n}\r\n</code></pre>\r\n\r\n**Notice** that ```task 2``` contains ```tasks``` itself.\r\nProcessus allows nesting of tasks and does not limit the level of nesting. This is\r\na powerful feature, but it does make some assumptions:\r\n\r\n1. The parent task opens directly after it's previous sibling\r\n2. The parent task CANNOT complete until ALL the child tasks have completed\r\n3. The parent task is therefore not executed until ALL of the children have completed\r\n4. Setting the parent's blocking property to false will NOT prevent it being delayed until\r\nthe child tasks have completed. However, that will cause it to open in parallel with its\r\nsiblings.\r\n\r\nIncidentally this is why a task's ```timeOpened``` time may differ from the ```timeStarted``` time. It's also why the ```totalDuration``` may be different from the ```handlerDuration```.\r\n\r\nRunning the demo\r\n<pre><code>\r\n$ ./bin/processus-cli -l info -f ./test/demo3.json\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-10-12 23:35:32 INFO testHandler:\r\n executing task 1\r\n2015-10-12 23:35:32 INFO Task Description:\r\n I am the task 1, I take 1500msecs.\r\n2015-10-12 23:35:33 INFO testHandler:\r\n completed task 1\r\n2015-10-12 23:35:33 INFO testHandler:\r\n executing task 2-1\r\n2015-10-12 23:35:33 INFO Task Description:\r\n I am the task 2-1, I take 1000msecs.\r\n2015-10-12 23:35:34 INFO testHandler:\r\n <b>completed task 2-1</b>\r\n2015-10-12 23:35:34 INFO testHandler:\r\n executing task 2-2\r\n2015-10-12 23:35:34 INFO Task Description:\r\n I am the task 2-2, I take 1000msecs.\r\n2015-10-12 23:35:35 INFO testHandler:\r\n <b>completed task 2-2</b>\r\n2015-10-12 23:35:35 INFO testHandler:\r\n executing task 2\r\n2015-10-12 23:35:35 INFO Task Description:\r\n I am the task 2, I take 1000msecs.\r\n2015-10-12 23:35:36 INFO testHandler:\r\n <b>completed task 2</b>\r\n2015-10-12 23:35:36 INFO testHandler:\r\n executing task 3\r\n2015-10-12 23:35:36 INFO Task Description:\r\n I am the task 3, I take 500msecs.\r\n2015-10-12 23:35:37 INFO testHandler:\r\n completed task 3\r\n2015-10-12 23:35:37 INFO Workflow returned successfully.\r\n</code></pre>\r\n\r\n**Notice** that task ```task 2-1``` and ```task 2-2``` are completed before the parent\r\ntask ```task 2``` is executed.\r\n\r\nTo understand this further, execute the same demo again, but this time with the loglevel set to ```debug``` and then take a look at the workflow object returned.\r\n<pre><code>\r\n$ ./bin/processus-cli -l debug -f ./test/demo3.json\r\n\r\n...\r\n...\r\n\r\n2015-10-13 00:18:47 INFO Workflow returned successfully.\r\n2015-10-13 00:18:47 DEBUG {\r\n  \"tasks\": {\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444695522056,\r\n      \"timeStarted\": 1444695522057,\r\n      \"timeCompleted\": 1444695523566,\r\n      \"handlerDuration\": 1509,\r\n      \"totalDuration\": 1510\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take 1000msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1000,\r\n        \"error\": false\r\n      },\r\n      \"tasks\": {\r\n        \"task 2-1\": {\r\n          \"description\": \"I am the task 2-1, I take 1000msecs.\",\r\n          \"blocking\": true,\r\n          \"handler\": \"../taskHandlers/testHandler\",\r\n          \"data\": {\r\n            \"delay\": 1000,\r\n            \"error\": false\r\n          },\r\n          \"status\": \"completed\",\r\n          \"timeOpened\": 1444695523566,\r\n          \"timeStarted\": 1444695523567,\r\n          \"timeCompleted\": 1444695524570,\r\n          \"handlerDuration\": 1003,\r\n          \"totalDuration\": 1004\r\n        },\r\n        \"task 2-2\": {\r\n          \"description\": \"I am the task 2-2, I take 1000msecs.\",\r\n          \"blocking\": true,\r\n          \"handler\": \"../taskHandlers/testHandler\",\r\n          \"data\": {\r\n            \"delay\": 1000,\r\n            \"error\": false\r\n          },\r\n          \"status\": \"completed\",\r\n          \"timeOpened\": 1444695524571,\r\n          \"timeStarted\": 1444695524571,\r\n          \"timeCompleted\": 1444695525577,\r\n          \"handlerDuration\": 1006,\r\n          \"totalDuration\": 1006\r\n        }\r\n      },\r\n      \"status\": \"completed\",\r\n      <b>\"timeOpened\": 1444695523566,\r\n      \"timeStarted\": 1444695525577,\r\n      \"timeCompleted\": 1444695526586,\r\n      \"handlerDuration\": 1009,\r\n      \"totalDuration\": 3020</b>\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take 500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 500,\r\n        \"error\": false\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444695526587,\r\n      \"timeStarted\": 1444695526587,\r\n      \"timeCompleted\": 1444695527091,\r\n      \"handlerDuration\": 504,\r\n      \"totalDuration\": 504\r\n    }\r\n  },\r\n  \"status\": \"completed\"\r\n}\r\n</code></pre>\r\n**Notice** that the times for task 2 reflect the assumptions made by the Processus engine.\r\n\r\n1. The task opened immediately, but was not executed i.e. ```timeOpened```\r\n2. The task started once its child tasks had completed successfully i.e. ```timeStarted```\r\n3. The ```handlerDuration``` i.e. the time to execute the task was ~1 sec (as configured), but overall it was open for ```totalDuration``` ~3 secs (i.e. a sec for each child and a sec for itself).\r\n\r\n[top](#processus)\r\n\r\n\r\n## Tasks - Nested Tasks (Parallel)\r\n```\r\n(start)-+--[task 1]-------------------+----(end)\r\n        |                             |\r\n        |--[          task 2       ]--|\r\n        |  |                          |\r\n        |  ()-[task 2-1]--[task 2-2]-()\r\n        |                             |\r\n        +--[task 3]-------------------+\r\n\r\n```\r\nThe JSON config file (demo4)\r\n<pre><code>\r\n{\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": <b>false</b>,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take 1000msecs.\",\r\n      \"blocking\": <b>false</b>,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1000,\r\n        \"error\": false\r\n      },\r\n      \"tasks\": {\r\n        \"task 2-1\": {\r\n          \"description\": \"I am the task 2-1, I take 1000msecs.\",\r\n          \"blocking\": <b>false</b>,\r\n          \"handler\" : \"../taskHandlers/testHandler\",\r\n          \"data\": {\r\n            \"delay\": 1000,\r\n            \"error\": false\r\n          }\r\n        },\r\n        \"task 2-2\": {\r\n          \"description\": \"I am the task 2-2, I take 1000msecs.\",\r\n          \"blocking\": <b>false</b>,\r\n          \"handler\" : \"../taskHandlers/testHandler\",\r\n          \"data\": {\r\n            \"delay\": 1000,\r\n            \"error\": false\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take 500msecs.\",\r\n      \"blocking\": <b>false</b>,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 500,\r\n        \"error\": false\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n</code></pre>\r\n\r\n**Notice** that ```task 2``` contains ```tasks``` itself.\r\n\r\nRunning the demo\r\n<pre><code>\r\n$ ./bin/processus-cli -l info -f ./test/demo4.json\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-10-13 00:03:04 INFO testHandler:\r\n executing task 1\r\n2015-10-13 00:03:04 INFO Task Description:\r\n I am the task 1, I take 1500msecs.\r\n2015-10-13 00:03:04 INFO testHandler:\r\n executing task 2-1\r\n2015-10-13 00:03:04 INFO Task Description:\r\n I am the task 2-1, I take 1000msecs.\r\n2015-10-13 00:03:04 INFO testHandler:\r\n executing task 2-2\r\n2015-10-13 00:03:04 INFO Task Description:\r\n I am the task 2-2, I take 1000msecs.\r\n2015-10-13 00:03:04 INFO testHandler:\r\n executing task 3\r\n2015-10-13 00:03:04 INFO Task Description:\r\n I am the task 3, I take 500msecs.\r\n2015-10-13 00:03:04 INFO testHandler:\r\n completed task 3\r\n2015-10-13 00:03:05 INFO testHandler:\r\n <b>completed task 2-1</b>\r\n2015-10-13 00:03:05 INFO testHandler:\r\n <b>completed task 2-2</b>\r\n2015-10-13 00:03:05 INFO testHandler:\r\n completed task 1\r\n2015-10-13 00:03:05 INFO testHandler:\r\n <b>executing task 2</b>\r\n2015-10-13 00:03:05 INFO Task Description:\r\n I am the task 2, I take 1000msecs.\r\n2015-10-13 00:03:06 INFO testHandler:\r\n completed task 2\r\n2015-10-13 00:03:06 INFO Workflow returned successfully.\r\n</code></pre>\r\n\r\n**Notice** that, once again, task ```task 2-1``` and ```task 2-2``` are completed before the parent\r\ntask ```task 2``` is executed. However, Processus evaluated the entire workflow\r\nand decided that it can run task 1, task2-1, task2-2, and task 3 ALL in parallel.\r\n\r\n[top](#processus)\r\n\r\n\r\n## Tasks - Mixing Sequential and Parallel Tasks\r\n\r\n```\r\n(start)-+--[task 1]--+--[task 3]--(end)\r\n        +--[task 2]--+\r\n```\r\n\r\nThe JSON config file (demo5)\r\n<pre><code>\r\n{\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      <b>\"blocking\": false,</b>\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take 1000msecs.\",\r\n      <b>\"blocking\": true,</b>\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1000,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take 500msecs.\",\r\n      <b>\"blocking\": true,</b>\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 500,\r\n        \"error\": false\r\n      }\r\n    }\r\n  }\r\n}\r\n</code></pre>\r\n\r\n**Notice** Processus follows the order the tasks are defined, but if a task's blocking property is set to false, it will continue and execute the next task(s) until it reaches a task with a blocking property set to true (or the end). In this case, tasks ```task 1``` and ```task 2``` run in parallel but ```task 3``` is forced to wait for ```task 2``` as its blocking property is set to true.\r\n\r\nRunning the demo\r\n<pre><code>\r\n$ ./bin/processus-cli -l info -f ./test/demo5.json\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-10-13 02:01:47 INFO testHandler:\r\n executing task 1\r\n2015-10-13 02:01:47 INFO Task Description:\r\n I am the task 1, I take 1500msecs.\r\n2015-10-13 02:01:47 INFO testHandler:\r\n executing task 2\r\n2015-10-13 02:01:47 INFO Task Description:\r\n I am the task 2, I take 1000msecs.\r\n2015-10-13 02:01:48 INFO testHandler:\r\n <b>completed task 2</b>\r\n2015-10-13 02:01:48 INFO testHandler:\r\n <b>completed task 1</b>\r\n2015-10-13 02:01:48 INFO testHandler:\r\n executing task 3\r\n2015-10-13 02:01:48 INFO Task Description:\r\n I am the task 3, I take 500msecs.\r\n2015-10-13 02:01:49 INFO testHandler:\r\n completed task 3\r\n2015-10-13 02:01:49 INFO Workflow returned successfully.\r\n</code></pre>\r\n\r\n**Notice** task 3 is forced to wait for tasks 1 and 2 (running in parallel).\r\n\r\n[top](#processus)\r\n\r\n\r\n## Tasks - Passing Data from Task to Task\r\n\r\nProcessus supports a very simple mechanism for referencing data between tasks.\r\n\r\nThe format is ```$[<path.to.reference>]```\r\n\r\nFor example, if a task has a data value of ```$[tasks.task 1.data.delay]``` this value\r\nwill be substituted at execution time with the value stored in the ```delay``` data property of ```task 1```.\r\n\r\nLet's try it out.\r\n\r\nThe JSON config file (demo6)\r\n<pre><code>\r\n{\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take as long as task1.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        <b>\"delay\": \"$[tasks.task 1.data.delay]\",</b>\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take as long as task1.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        <b>\"delay\": \"$[tasks.task 1.data.delay]\",</b>\r\n        \"error\": false\r\n      }\r\n    }\r\n  }\r\n}\r\n</code></pre>\r\n\r\n**Notice** the data delay value for tasks 2 and 3. As with the example above, these values\r\nwill be substituted with the value of ```task 1.data.delay``` in this case that's ```1500```\r\nMeaning each task will now be delayed 1.5seconds.\r\n\r\nRunning the demo\r\n<pre><code>\r\n$ ./bin/processus-cli -l debug -f ./test/demo6.json\r\n\r\n...\r\n...\r\n\r\n2015-10-13 18:38:38 INFO Workflow returned successfully.\r\n2015-10-13 18:38:38 DEBUG {\r\n  \"tasks\": {\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444761514349,\r\n      \"timeStarted\": 1444761514350,\r\n      \"timeCompleted\": 1444761515857,\r\n      \"handlerDuration\": 1507,\r\n      \"totalDuration\": 1508\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take as long as task1.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        <b>\"delay\": \"1500\"</b>,\r\n        \"error\": false\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444761515857,\r\n      \"timeStarted\": 1444761515859,\r\n      \"timeCompleted\": 1444761517370,\r\n      \"handlerDuration\": 1511,\r\n      \"totalDuration\": 1513\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take as long as task1.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        <b>\"delay\": \"1500\"</b>,\r\n        \"error\": false\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444761517371,\r\n      \"timeStarted\": 1444761517372,\r\n      \"timeCompleted\": 1444761518879,\r\n      \"handlerDuration\": 1507,\r\n      \"totalDuration\": 1508\r\n    }\r\n  },\r\n  \"status\": \"completed\"\r\n}\r\n</code></pre>\r\n\r\n**Notice** that the resulting workflow object now has the referenced value for tasks 2 and 3.\r\nThis demo was simple, but later we'll see how Task Handler's can return data values\r\nand as such affect the operation of subsequent tasks that may reference that output data.\r\n\r\n[top](#processus)\r\n\r\n\r\n## Workflow - Passing Static Data to Tasks\r\n\r\nThe parent Workflow object can also contain data, that can be referenced by tasks.\r\n\r\nThe JSON config file (demo7)\r\n<pre><code>\r\n{\r\n  <b>\"static\":{\r\n    \"global-delay\":500,\r\n    \"global-error\":false\r\n  },</b>\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take global-delay msecs, which is 500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        <b>\"delay\": \"$[static.global-delay]\",\r\n        \"error\": \"$[static.global-error]\"</b>\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take global-delay msecs, which is 500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        <b>\"delay\": \"$[static.global-delay]\",\r\n        \"error\": \"$[static.global-error]\"</b>\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take global-delay msecs, which is 500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        <b>\"delay\": \"$[static.global-delay]\",\r\n        \"error\": \"$[static.global-error]\"</b>\r\n      }\r\n    }\r\n  }\r\n}\r\n</code></pre>\r\n\r\nRunning the demo\r\n<pre><code>\r\n$ ./bin/processus-cli -l debug -f ./test/demo7.json\r\n\r\n...\r\n...\r\n\r\n2015-10-13 18:43:47 INFO Workflow returned successfully.\r\n2015-10-13 18:43:47 DEBUG {\r\n  <b>\"static\": {\r\n    \"global-delay\": 500,\r\n    \"global-error\": false\r\n  },</b>\r\n  \"tasks\": {\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take global-delay msecs, which is 500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        <b>\"delay\": \"500\",\r\n        \"error\": \"false\"</b>\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444761826343,\r\n      \"timeStarted\": 1444761826349,\r\n      \"timeCompleted\": 1444761826857,\r\n      \"handlerDuration\": 508,\r\n      \"totalDuration\": 514\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take global-delay msecs, which is 500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        <b>\"delay\": \"500\",\r\n        \"error\": \"false\"</b>\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444761826857,\r\n      \"timeStarted\": 1444761826859,\r\n      \"timeCompleted\": 1444761827371,\r\n      \"handlerDuration\": 512,\r\n      \"totalDuration\": 514\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take global-delay msecs, which is 500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        <b>\"delay\": \"500\",\r\n        \"error\": \"false\"</b>\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444761827372,\r\n      \"timeStarted\": 1444761827374,\r\n      \"timeCompleted\": 1444761827886,\r\n      \"handlerDuration\": 512,\r\n      \"totalDuration\": 514\r\n    }\r\n  },\r\n  \"status\": \"completed\"\r\n}\r\n</code></pre>\r\n\r\n**Notice** that all tasks have the same values as the static element in the parent workflow object.\r\n\r\n[top](#processus)\r\n\r\n## Workflow - Handling Errors\r\n\r\nWhen a task returns an error Processus stops the overall workflow and sets its status to ```error```\r\n\r\nThe JSON config file (demo8)\r\n<pre><code>\r\n{\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take 1000msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1000,\r\n        <b>\"error\": true</b>\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take 1500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\" : \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      }\r\n    }\r\n  }\r\n}\r\n</code></pre>\r\n**Notice** that task 2 is set to raise an error from the test handler.\r\n\r\nRunning the demo\r\n<pre><code>\r\n$ ./bin/processus-cli -l info -f ./test/demo8.json\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-10-14 00:29:51 INFO testHandler:\r\n executing task 1\r\n2015-10-14 00:29:51 INFO Task Description:\r\n I am the task 1, I take 1500msecs.\r\n2015-10-14 00:29:52 INFO testHandler:\r\n completed task 1\r\n2015-10-14 00:29:52 INFO testHandler:\r\n executing task 2\r\n2015-10-14 00:29:52 INFO Task Description:\r\n I am the task 2, I take 1000msecs.\r\n2015-10-14 00:29:53 INFO testHandler:\r\n completed task 2\r\n<b>2015-10-14 00:29:53 ERROR This is an error from the task task 2</b>\r\n</code></pre>\r\n\r\nLet's take a close look at the status of the workflow and its tasks.\r\nRe-run the demo with the log level of ```debug```\r\n<pre><code>\r\n$ ./bin/processus-cli -l debug -f ./test/demo8.json\r\n\r\n...\r\n...\r\n\r\n2015-10-14 00:34:54 ERROR This is an error from the task task 2\r\n2015-10-14 00:34:54 DEBUG {\r\n  \"tasks\": {\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I take 1500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444782891803,\r\n      \"timeStarted\": 1444782891804,\r\n      \"timeCompleted\": 1444782893322,\r\n      \"handlerDuration\": 1518,\r\n      \"totalDuration\": 1519\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I take 1000msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1000,\r\n        \"error\": \"This is an error from the task task 2\"\r\n      },\r\n      <b>\"status\": \"error\",</b>\r\n      \"timeOpened\": 1444782893322,\r\n      \"timeStarted\": 1444782893323\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I take 1500msecs.\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/testHandler\",\r\n      \"data\": {\r\n        \"delay\": 1500,\r\n        \"error\": false\r\n      },\r\n      <b>\"status\": \"waiting\"</b>\r\n    }\r\n  },\r\n  \"status\": \"open\",\r\n  <b>\"satus\": \"error\"</b>\r\n}\r\n</code></pre>\r\n**Notice** that the status of task 2 and the workflow are both ```error```. Also note that task 3 has a status ```waiting``` i.e. it was never started!\r\n\r\n[top](#processus)\r\n\r\n## Task Handlers - The Interface\r\n\r\nProcessus ships with 2 task handlers:\r\n\r\n1. The ```testHandler.js``` (what you've been using for the demos)\r\n2. The ```shellHandler.js``` (A more useful task handler used to execute local shell commands)\r\n\r\nThe interface for writing a taskHandler is simple:\r\n```\r\nmodule.exports = function(name, task, callback, logger){\r\n\r\n}\r\n```\r\nDuring execution, Processus calls the task handler passing in the following:\r\n\r\n1. **name** A string matching the name of the task\r\n2. **task** The object representing the task\r\n3. **callback** A function the taskhandler MUST call when complete which takes 2 arguments (error, task)\r\n  * **error** An error or null\r\n  * **task** The UPDATED task. i.e. The task handler can update data values and pass them back\r\n4. **logger** A logger relative to the Processus engine, that the task handler can use to log as its running.\r\n\r\nIf you want to write your own taskHandler (very much encouraged) please look at the examples.\r\n\r\n[top](#processus)\r\n\r\n\r\n## Task Handlers - Shell Handler\r\n\r\nLet's take a closer look at the shellHandler\r\n\r\n<pre><code>\r\nvar exec = require('child_process').exec;\r\n\r\n/* Shell Task Handler\r\n * Using the Task's data.cmd property, this handler will attempt to execute that\r\n * command as a child process.\r\n */\r\nmodule.exports = function(name, task, callback, logger){\r\n  //validate that task data element exists\r\n  if(!task.data) {\r\n    callback(new Error(\"No task data property!\"), task);\r\n  }\r\n  //Validate that the data cmd property has been set\r\n  if(!task.data.cmd) {\r\n    callback(new Error(\"No data cmd property set!\"), task);\r\n  }\r\n  //execute the command and check the response\r\n  exec(task.data.cmd, function(error, stdout, stderr) {\r\n    task.data.stdout = stdout;\r\n    task.data.stderr = stderr;\r\n    if(stdout){ logger.info(stdout); }\r\n    if(stderr){ logger.error(stderr); }\r\n    //let the processus know what happened\r\n    callback(error, task);\r\n  });\r\n};\r\n</code></pre>\r\n\r\n**Notice** that the handler performs the following:\r\n\r\n1. checks the supplied task contains the data items it expects. i.e. ```task.data.cmd```\r\n2. Executes the command identified by the ```cmd``` data property\r\n3. Captures the response and NEW data items ```stdout``` and ```stderr```\r\n4. Logs the results\r\n5. Calls Processus back with any error and the updated task.\r\n\r\nNOTE: the task handler does NOT set the status of the task, ***usually*** Processus will handle that for you.\r\n\r\n[top](#processus)\r\n\r\n\r\n## Task Handlers - Shell Demo\r\n\r\nThe JSON config file (demo9)\r\n<pre><code>\r\n{\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I echo Processus\",\r\n      \"blocking\": true,\r\n      <b>\"handler\" : \"../taskHandlers/shellHandler\",</b>\r\n      \"data\": {\r\n        <b>\"cmd\": \"echo Processus\"</b>\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I echo Simple\",\r\n      \"blocking\": true,\r\n      <b>\"handler\" : \"../taskHandlers/shellHandler\",</b>\r\n      \"data\": {\r\n        <b>\"cmd\": \"echo Simple\"</b>\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I echo Workflow\",\r\n      \"blocking\": true,\r\n      <b>\"handler\" : \"../taskHandlers/shellHandler\",</b>\r\n      \"data\": {\r\n        <b>\"cmd\": \"echo Workflow\"</b>\r\n      }\r\n    }\r\n  }\r\n}\r\n</pre></code>\r\n\r\n**Notice** the shell task handler and cmd for each task.\r\n\r\n\r\nRunning the demo\r\n<pre><code>\r\n$ ./bin/processus-cli -l info -f ./test/demo9.json\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-10-14 01:01:57 INFO Processus\r\n\r\n2015-10-14 01:01:57 INFO Simple\r\n\r\n2015-10-14 01:01:57 INFO Workflow\r\n\r\n2015-10-14 01:01:57 INFO Workflow returned successfully.\r\n</code></pre>\r\n\r\n**Notice** each task output ```Processus Simple Workflow```\r\n\r\nLet's take a closer look at each task by re-running the demo at the debug level.\r\n\r\n<pre><code>\r\n$ ./bin/processus-cli -l debug -f ./test/demo9.json\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-10-14 01:07:01 INFO Processus\r\n\r\n2015-10-14 01:07:01 INFO Simple\r\n\r\n2015-10-14 01:07:01 INFO Workflow\r\n\r\n2015-10-14 01:07:01 INFO Workflow returned successfully.\r\n2015-10-14 01:07:01 DEBUG {\r\n  \"tasks\": {\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I echo Processus\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/shellHandler\",\r\n      \"data\": {\r\n        \"cmd\": \"echo Processus\",\r\n        <b>\"stdout\": \"Processus\\n\",\r\n        \"stderr\": \"\"</b>\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444784821173,\r\n      \"timeStarted\": 1444784821174,\r\n      \"timeCompleted\": 1444784821215,\r\n      \"handlerDuration\": 41,\r\n      \"totalDuration\": 42\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I echo Simple\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/shellHandler\",\r\n      \"data\": {\r\n        \"cmd\": \"echo Simple\",\r\n        <b>\"stdout\": \"Simple\\n\",\r\n        \"stderr\": \"\"</b>\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444784821215,\r\n      \"timeStarted\": 1444784821216,\r\n      \"timeCompleted\": 1444784821223,\r\n      \"handlerDuration\": 7,\r\n      \"totalDuration\": 8\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I echo Workflow\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/shellHandler\",\r\n      \"data\": {\r\n        \"cmd\": \"echo Workflow\",\r\n        <b>\"stdout\": \"Workflow\\n\",\r\n        \"stderr\": \"\"</b>\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1444784821223,\r\n      \"timeStarted\": 1444784821224,\r\n      \"timeCompleted\": 1444784821232,\r\n      \"handlerDuration\": 8,\r\n      \"totalDuration\": 9\r\n    }\r\n  },\r\n  \"status\": \"completed\"\r\n}\r\n</code></pre>\r\n\r\n**Notice** the ```stdout``` and ```stderr``` data properties added to each task in the workflow object.\r\n\r\nHopefully this starts to show the potential power of Processus.\r\n\r\n[top](#processus)\r\n\r\n## Tasks - Conditions skipIf and errorIf\r\n\r\nTasks can have the extra properties ```skipIf``` and ```errorIf```.\r\n\r\nAs the names suggest, if either property evaluates to true, then Processus will either skip the task and just mark it as completed or raise an error and stop.\r\n\r\nAs with sharing data values, you can reference another part of the workflow and have that substituted at execution time. Processus will evaluate the string condition and set property appropriately. Any string with the value ```true``` regardless of case, will evaluate to true. Any other string will evaluate to ```false```.\r\n\r\nLook at demo10 to see an example of ```skipIf``` and ```errorIf``` in action.\r\n\r\nThe JSON config file (demo10)\r\n<pre><code>\r\n{\r\n  \"tasks\":{\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I echo Processus\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/shellHandler\",\r\n      \"data\": {\r\n        \"cmd\": \"echo Processus\",\r\n        \"skip me\": \"true\"\r\n      }\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I will be skipped\",\r\n      \"blocking\": true,\r\n      <b>\"skipIf\":\"$[tasks.task 1.data.skip me]\",</b>\r\n      \"handler\": \"../taskHandlers/shellHandler\",\r\n      \"data\": {\r\n        \"cmd\": \"echo Simple\"\r\n      }\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I will error\",\r\n      \"blocking\": true,\r\n      <b>\"errorIf\": \"$[tasks.task 2.skipIf]\",</b>\r\n      \"handler\": \"../taskHandlers/shellHandler\",\r\n      \"data\": {\r\n        \"cmd\": \"echo Workflow\"\r\n      }\r\n    }\r\n  }\r\n}\r\n</code></pre>\r\n\r\n**Notice** the skipIf and errorIf properties of tasks 2 and 3.\r\n\r\n```$[tasks.task 1.data.skip me]``` will become ```true``` at execution time, evaluating to true, so the task will be skipped.\r\n\r\n```$[tasks.task 2.skipIf]``` will become ```true``` because that's what the skipIf will evaluate to.\r\n\r\nRunning the demo\r\n<pre><code>\r\n$ ./bin/processus-cli -f test/demo10.json -l debug\r\n\r\n  ____  ____   __    ___  ____  ____  ____  _  _  ____\r\n (  _ \\(  _ \\ /  \\  / __)(  __)/ ___)/ ___)/ )( \\/ ___)\r\n  ) __/ )   /(  O )( (__  ) _) \\___  \\___ \\) \\/ (\\___ \\\r\n (__)  (__\\_) \\__/  \\___)(____)(____/(____/\\____/(____/\r\n\r\n           Processus: A Simple Workflow Engine.\r\n\r\n2015-10-20 15:00:39 DEBUG task.skipIf = undefined\r\n2015-10-20 15:00:39 DEBUG task.errorIf = undefined\r\n2015-10-20 15:00:39 INFO Processus\r\n\r\n2015-10-20 15:00:39 DEBUG Getting data for path: tasks.task 1.data.skip me\r\n2015-10-20 15:00:39 DEBUG $[tasks.task 1.data.skip me] is yeah has ref: tasks.task 1.data.skip me\r\n2015-10-20 15:00:39 DEBUG $[tasks.task 1.data.skip me] is yeah de-referenced value is: true\r\n2015-10-20 15:00:39 DEBUG evaluating condition true\r\n2015-10-20 15:00:39 DEBUG task.skipIf = true\r\n2015-10-20 15:00:39 DEBUG task.errorIf = undefined\r\n2015-10-20 15:00:39 DEBUG Getting data for path: tasks.task 2.skipIf\r\n2015-10-20 15:00:39 DEBUG $[tasks.task 2.skipIf] has ref: tasks.task 2.skipIf\r\n2015-10-20 15:00:39 DEBUG $[tasks.task 2.skipIf] de-referenced value is: true\r\n2015-10-20 15:00:39 DEBUG evaluating condition true\r\n2015-10-20 15:00:39 DEBUG task.skipIf = undefined\r\n2015-10-20 15:00:39 DEBUG task.errorIf = true\r\n2015-10-20 15:00:39 ERROR Task has error condition set.\r\n2015-10-20 15:00:39 DEBUG {\r\n  \"tasks\": {\r\n    \"task 1\": {\r\n      \"description\": \"I am the task 1, I echo Processus\",\r\n      \"blocking\": true,\r\n      \"handler\": \"../taskHandlers/shellHandler\",\r\n      \"data\": {\r\n        \"cmd\": \"echo Processus\",\r\n        \"skip me\": \"yeah\",\r\n        \"stdout\": \"Processus\\n\",\r\n        \"stderr\": \"\"\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1445353239367,\r\n      \"timeStarted\": 1445353239369,\r\n      \"timeCompleted\": 1445353239395,\r\n      \"handlerDuration\": 26,\r\n      \"totalDuration\": 28\r\n    },\r\n    \"task 2\": {\r\n      \"description\": \"I am the task 2, I will be skipped\",\r\n      \"blocking\": true,\r\n      \"skipIf\": true,\r\n      \"handler\": \"../taskHandlers/shellHandler\",\r\n      \"data\": {\r\n        \"cmd\": \"echo Simple\"\r\n      },\r\n      \"status\": \"completed\",\r\n      \"timeOpened\": 1445353239395,\r\n      \"timeStarted\": 1445353239397,\r\n      \"timeCompleted\": 1445353239398,\r\n      \"handlerDuration\": 1,\r\n      \"totalDuration\": 3\r\n    },\r\n    \"task 3\": {\r\n      \"description\": \"I am the task 3, I will error\",\r\n      \"blocking\": true,\r\n      \"errorIf\": true,\r\n      \"handler\": \"../taskHandlers/shellHandler\",\r\n      \"data\": {\r\n        \"cmd\": \"echo Workflow\",\r\n        \"error\": \"Task has error condition set.\"\r\n      },\r\n      \"status\": \"error\",\r\n      \"timeOpened\": 1445353239398,\r\n      \"timeStarted\": 1445353239399\r\n    }\r\n  },\r\n  \"status\": \"error\"\r\n}\r\n</code></pre>\r\n\r\n**Notice** that because the ```skipIf``` and ```errorIf``` properties of task 1 are undefined, no evaluation of the condition takes place and the task executes normally. Task 2 did complete, but because the ```skipIf``` evaluates to true, the task handler is NOT executed. Therefore the ```'echo Simple'``` did not execute. Finally, notice that task 3 is in the error status (due to the ```errorIf``` condition) and therefore so is the workflow.\r\n\r\n[top](#processus)\r\n\r\n# Contributing\r\n\r\nTBC\r\n\r\n## Contributing - Roadmap\r\n\r\n1. Workflow Persistence Plugin Architecture\r\n * filebased, default\r\n * Mongodb\r\n2. Restarting a paused workflow (allowing for Async handlers)\r\n3. Full REST API to interact with Processus\r\n * Swagger yaml\r\n4. HTTP Handler allowing Processus to interact with remote endpoints during workflow execution\r\n5. Workflow Handler allowing a task to create another workflow (i.e. nested Sync and Async Workflows)\r\n6. Support for nested tasks \"injected\" at execution by handlers\r\n7. Support for environment variables\r\n\r\n[top](#processus)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}